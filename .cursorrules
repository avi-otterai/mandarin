# Mandarin - Chinese Learning App

## Project Context
React/TypeScript webapp for learning Mandarin Chinese using spaced repetition (SRS).
See README.md for full feature list and setup.

## Repository
- **GitHub**: https://github.com/avi-otterai/mandarin.git
- **Remote**: `origin` using `github.com-avi` SSH alias (personal key)

---

## Task Workflow (ALWAYS FOLLOW)

When working on any new task/feature:
Note that after completion of a feature/fix, you must automatically fix readme (but after testing and running server).
Then you must attempt to commit, merge, push, again without the user having to say it. If they don't want to push they'll reject.

### 1. Understand First
- [ ] Read `README.md` for project overview
- [ ] Read `.cursorrules` for conventions and context
- [ ] Understand current code structure before making changes

### 2. Plan Before Implementing
- [ ] Outline the approach/changes needed
- [ ] Confirm plan with user if it's a large change

### 3. Implement
- [ ] Create a **new feature branch** (never commit directly to main)
- [ ] Make changes following existing code patterns
- [ ] Test locally if applicable

### 4. Document
- [ ] Update `README.md` if adding features or changing behavior
- [ ] Add comments for complex logic

### 5. Test Before Push
- [ ] Run `npm run dev` to test locally
- [ ] Run `npm run build` to verify no TypeScript/build errors
- [ ] Fix any issues before committing

### 6. Commit & Push
- [ ] Check git status, diffs to understand not just your current changes but other simultaneous ones
- [ ] Commit with a descriptive message for all changes
- [ ] Push to origin (default behavior unless user says otherwise)

```bash
git checkout main
git merge feature/your-feature-name
git push origin main
```

## Tech Stack
- React 19 + TypeScript
- Vite (build tool)
- Tailwind CSS v4 + daisyUI v5
- localStorage (current storage)
- Supabase (for cloud sync)

## Running Locally
```bash
npm install
npm run dev
```
Open http://localhost:5173/

---

## Git Workflow

### Branch Strategy
- **main**: Single branch for all development.

### Committing
If GPG signing fails, use:
```bash
git commit --no-gpg-sign -m "your message"
```

### Pushing to GitHub
This repo uses the `github.com-avi` SSH alias (personal key, not work key):
```bash
git push -u origin feature/your-feature-name
```

**Important for Cursor terminal**: Always use `required_permissions: ["all"]` when pushing to access SSH keys.

### Merging to Main
1. Make changes
2. Merge locally
3. After server testing, push
```bash
git add .
git status
git commit -m "long message"
git push origin main
```
Note that there may be simultaneous edits by other cursor agents, so git status (and maybe diff) will help you understand what full commit is about.

### SSH Configuration
The repo uses `github.com-avi` alias which maps to personal SSH key (`~/.ssh/id_ed25519`), not the work Teleport certificate.

---

## Key Files
- `src/pages/VocabularyPage.tsx` - Vocabulary table with filters
- `src/pages/RevisePage.tsx` - Flashcard review (ONLY shows known words!)
- `src/stores/vocabularyStore.ts` - State + localStorage persistence
- `src/utils/srs.ts` - SRS algorithm
- `src/data/hsk1_vocabulary.json` - HSK1 word list

---

## ⚠️ CRITICAL: Known vs Unknown Words

**This is the most important concept in the app - understand this before making any changes!**

### Binary Categories (ONLY 2)
| Status | Checkbox | understanding | In Revise? |
|--------|----------|---------------|------------|
| **Known** | ✓ Checked | spectrum | **YES** |
| **Unknown** | ☐ Unchecked | spectrum | **NO** |


### Why Vocab-led design
- **Avoids overwhelm**: User only sees words they've explicitly selected
- **Controlled learning**: Start with a few checked words, expand gradually
- **Intentional vocabulary**: Revise tab is never cluttered with unselected words


## Data Storage
- **Local**: localStorage (key: `langseed_progress`) - instant reads/writes
- **Cloud**: Supabase PostgreSQL with RLS (user-level row security)
  - Tables: `vocabulary`, `user_progress`, `quiz_attempts`
  - Sync: Auto-sync after quiz answers

## Supabase Config
All Supabase credentials are stored in `.env` (see `.env.example`):
- `VITE_SUPABASE_URL` - Your Supabase project URL
- `VITE_SUPABASE_ANON_KEY` - Public anon key (safe for client-side)
- `VITE_DEV_USER_EMAIL` - Dev auto-login email (optional)
- `VITE_DEV_USER_PASSWORD` - Dev auto-login password (optional)

---

## Default User Preferences

### Development User
- **Email**: Set via `VITE_DEV_USER_EMAIL` in `.env`
- **Password**: Set via `VITE_DEV_USER_PASSWORD` in `.env`
- Auto-login only works in development mode when both are configured

### Vocabulary Preferences
- **Selected Chapters**: 1, 2, 3, 4, 5, 6 (HSK1 chapters)
- Additional user preferences to be added as features develop
